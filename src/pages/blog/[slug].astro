---
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'
import CopyCode from '../../components/copy-code.astro'
import Prose from '../../components/prose.astro'
import TextTitle from '../../components/text-title.astro'
import Layout from '../../layout/layout.astro'
import { getReadingTime } from '../../utils/reading-time'
import { getDateFormatted } from '../../utils/time-format'

const { post } = Astro.props
const { title, description, pubDate } = post.data
const { Content } = await post.render()
const canonical = 'https://guimox.dev/blog' + post.slug
const current = 'blog'

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }))
}
---

<Layout title={title} description={description} canonical={canonical} current={current}>
  <article>
    <div class="mb-6 flex flex-col items-start gap-4 text-base md:mb-10">
      <div class="full flex flex-col gap-3">
        <TextTitle bold>{title}</TextTitle>
        <p class="text-base">{description}</p>
        <div class="flex gap-3">
          <div class="flex items-center gap-2">
            <Icon name="mdi:calendar-blank-outline" class="text-sm text-color" />
            {getDateFormatted(pubDate)}
          </div>
          <div class="flex items-center gap-1">
            <Icon name="mdi:stopwatch-outline" class="text-sm text-color" />
            {getReadingTime(post.body)}
          </div>
        </div>
      </div>
      <div class="h-[0.5rem] w-10 rounded-sm bg-color"></div>
    </div>
    <Prose>
      <Content />
      <CopyCode />
    </Prose>
  </article>
</Layout>
